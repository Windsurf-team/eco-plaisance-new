<section id="avis" class="avis-new-section">
  <div class="avis-container">
    <div class="avis-header">
      <h2 class="avis-title">
        <span class="pre-title">ILS PARLENT DE NOUS</span>
        AVIS <span class="accent">GOOGLE</span>
      </h2>
      <div class="google-rating">
        <span class="score">4,9/5</span>
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <span class="count">Bas√© sur 167 avis</span>
      </div>
    </div>

    <!-- Carousel -->
    <div class="avis-carousel" aria-label="Carrousel d'avis">
      <button class="avis-nav avis-nav--prev" type="button" aria-label="Avis pr√©c√©dent">
        ‚Äπ
      </button>

      <div class="avis-viewport">
        <div class="avis-track">
          <!-- 1 -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">R</div>
              <div class="info">
                <span class="name">Rafael Bernardes</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Tr√®s bonne exp√©rience de location de bateau sans permis pour d√©couvrir le bassin d‚ÄôArcachon et le parc ornithologique du Teich. L‚Äô√©quipe est super accueillante, les explications sont claires et le service est top du d√©but √† la fin. Une balade agr√©able et facile √† faire, m√™me sans exp√©rience en navigation. On recommande !</p>
          </article>

          <!-- 2 -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">M</div>
              <div class="info">
                <span class="name">Mathis Chaudemanche</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Nous avons pass√© un moment absolument magique avec E-CO Plaisance BA au Teich. Conditions parfaites : mer calme, un coucher de soleil splendide et l‚Äôimpression d‚Äô√™tre seuls au monde. Le couple de g√©rants est adorable, accueillant et attentionn√©. Une exp√©rience inoubliable que nous avons d√©j√† h√¢te de renouveler !<br><br>Merci beaucoup pour votre accueil üôè</p>
          </article>

          <!-- 3 -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">E</div>
              <div class="info">
                <span class="name">Eric Vandenberghe</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Tr√®s jolie balade, dans un environnement calme et reposant. Bateaux faciles √† utiliser. Accueil sympa et instructions claires donn√©es au d√©part. Bref, un chouette moment en famille √† recommander.</p>
          </article>

          <!-- 4 -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">K</div>
              <div class="info">
                <span class="name">Karine M.</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">
              Super balade romantique le long du chenal entre le port du Teich et le bassin. Aucun bruit pour observer la nature. Nous avons √©t√© survol√©s par des canards, des cygnes... je vous recommande le cr√©neau du soir pour terminer par un coucher de soleil. Les bateaux sont tr√®s stables (chenal), et faciles √† prendre en main (manette avant, arri√®re et volant pour diriger. Parfait pour balade en amoureux ou en famille. Le batelier est bienveillant et adorable. Il donne bien toutes les explications. C'est une super activit√© que je recommande !!!!!!
            </p>
          </article>

          <!-- 5 (ajout) -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">O</div>
              <div class="info">
                <span class="name">
Organisme de formation Jallons ROUSSE C√©line</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Parfait,
Balade en bateau √©lectrique en famille d'1h30 pour nous sur la Leyre et le bassin.
Conduite facile.
Nous avons pass√© un bon moment en fin de journ√©e.
Petit plus: les propri√©taires sont tr√®s sympathiques.
Je recommande.</p>
          </article>

          <!-- 6 (ajout) -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">M</div>
              <div class="info">
                <span class="name">Maiwenn LE BRECH</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Nous avons ador√© cette balade en bateau au coucher du soleil, c‚Äô√©tait magnifique ! L‚Äô√©quipe est tr√®s sympathique, accueillante et explique tout clairement. Une superbe exp√©rience que nous recommandons !</p>
          </article>

          <!-- 7 (ajout) -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">C</div>
              <div class="info">
                <span class="name">christine dupuy</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Merci pour cette belle d√©couverte du delta , une balade contemplative au calme, avec de tr√®s belles couleurs aussi en fin de journ√©e et une vue magnifique sur le bassin. Bateau tr√®s silencieux et propre, facile √† conduire.Un accueil chaleureux. Merci √† Fr√©d√©ric et Anne.</p>
          </article>

          <!-- 8 (ajout) -->
          <article class="avis-card">
            <div class="card-top">
              <div class="avatar">E</div>
              <div class="info">
                <span class="name">√âmeline Riquelme</span>
                <div class="stars-gold">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              </div>
            </div>
            <p class="text">Exceptionnel ! Tout simplement magique !
Tr√®s ludique, hyper simple d‚Äôutilisation, les explications sont claires et simples avant le d√©part.
Balade en famille inoubliable garantie!
Nous avons fait la balade de 1h30 au couch√© du soleil, sortie familiale tout √† fait abordable au vu de la prestation.
Merci pour votre accueil et votre gentillesse.
On reviendra en septembre avec beaucoup de plaisir.</p>
          </article>
        </div>
      </div>

      <button class="avis-nav avis-nav--next" type="button" aria-label="Avis suivant">
        ‚Ä∫
      </button>
    </div>

    <div class="avis-dots" aria-label="Pagination avis"></div>

    <div class="avis-footer">
      <a href="#formulaire" class="cta-button">Convaincu ? Je m'inscris !</a>
    </div>
  </div>

  <style>
    .avis-new-section {
      padding: 80px 20px;
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
      color: #333;
      overflow: hidden;
    }
    .avis-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .avis-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .pre-title {
      display: block;
      font-size: 14px;
      color: #ff6600;
      font-weight: bold;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }
    .avis-title {
      font-size: 36px;
      font-weight: 900;
      margin: 0;
      color: #1a1a1a;
    }
    .avis-title .accent { color: #4285F4; }
    .google-rating {
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .google-rating .score { font-weight: bold; font-size: 18px; }
    .google-rating .stars { color: #fbbc05; font-size: 20px; }
    .google-rating .count { color: #666; font-size: 14px; }

    /* Carousel layout */
    .avis-carousel{
      position: relative;
      display: grid;
      grid-template-columns: 48px 1fr 48px;
      align-items: center;
      gap: 14px;
      margin: 10px 0 18px;
    }
    .avis-viewport{
      overflow: hidden;
      border-radius: 18px;
    }
    .avis-track{
      display: flex;
      gap: 25px;
      transition: transform .45s ease;
      will-change: transform;
      padding: 6px 2px 18px;
    }

    /* Card */
    .avis-card {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      min-width: calc((100% - 50px) / 3); /* 3 cartes desktop (2 gaps de 25 = 50) */
    }
    .avis-card:hover { transform: translateY(-5px); }

    .card-top {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .avatar {
      width: 50px;
      height: 50px;
      background: #4285F4;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 20px;
      flex: 0 0 auto;
    }
    .name { display: block; font-weight: bold; font-size: 16px; }
    .stars-gold { color: #fbbc05; font-size: 14px; }
    .text {
      font-size: 15px;
      line-height: 1.6;
      color: #555;
      margin: 0;
      font-style: italic;
    }

    /* Nav buttons */
    .avis-nav{
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: 0;
      background: #fff;
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
      cursor: pointer;
      font-size: 26px;
      line-height: 1;
      display: grid;
      place-items: center;
      color: #1a1a1a;
      transition: transform .2s ease, opacity .2s ease;
      user-select: none;
    }
    .avis-nav:hover { transform: translateY(-1px); }
    .avis-nav:disabled{
      opacity: .35;
      cursor: not-allowed;
      transform: none;
    }

    /* Dots */
    .avis-dots{
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 8px;
    }
    .avis-dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 0;
      background: rgba(26,26,26,.25);
      cursor: pointer;
      transition: transform .2s ease, background .2s ease;
    }
    .avis-dot[aria-current="true"]{
      background: rgba(66,133,244,1);
      transform: scale(1.15);
    }

    .avis-footer { text-align: center; margin-top: 26px; }
    .cta-button {
      display: inline-block;
      background-color: #ff6600;
      color: #fff;
      padding: 18px 35px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
      text-transform: uppercase;
      transition: background 0.3s;
    }
    .cta-button:hover { background-color: #e65c00; }

    /* Responsive: 2 cards tablet */
    @media (max-width: 980px) {
      .avis-card { min-width: calc((100% - 25px) / 2); }
      .avis-title { font-size: 30px; }
    }

    /* Responsive: 1 card mobile */
    @media (max-width: 640px) {
      .avis-carousel{ grid-template-columns: 40px 1fr 40px; gap: 10px; }
      .avis-nav{ width: 40px; height: 40px; font-size: 22px; }
      .avis-card { min-width: 100%; }
      .avis-title { font-size: 26px; }
    }
  </style>

  <script>
    (function initAvisCarousel(){
      const root = document.querySelector('#avis.avis-new-section');
      if (!root) return;

      const track = root.querySelector('.avis-track');
      const viewport = root.querySelector('.avis-viewport');
      const prev = root.querySelector('.avis-nav--prev');
      const next = root.querySelector('.avis-nav--next');
      const dotsWrap = root.querySelector('.avis-dots');

      if (!track || !viewport || !prev || !next || !dotsWrap) return;

      const cards = Array.from(track.children);
      const gap = 25; // doit matcher le gap CSS desktop (25)
      let index = 0;
      let perView = 3;
      let pages = 1;

      function calcPerView(){
        const w = window.innerWidth;
        if (w <= 640) return 1;
        if (w <= 980) return 2;
        return 3;
      }

      function buildDots(){
        dotsWrap.innerHTML = '';
        for (let i = 0; i < pages; i++){
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'avis-dot';
          b.setAttribute('aria-label', 'Aller √† la page ' + (i + 1));
          b.addEventListener('click', () => { index = i; update(); });
          dotsWrap.appendChild(b);
        }
      }

      function setActiveDot(){
        const dots = Array.from(dotsWrap.querySelectorAll('.avis-dot'));
        dots.forEach((d, i) => d.setAttribute('aria-current', i === index ? 'true' : 'false'));
      }

      function clampIndex(){
        const max = Math.max(0, pages - 1);
        if (index < 0) index = 0;
        if (index > max) index = max;
      }

      function update(){
        perView = calcPerView();
        pages = Math.ceil(cards.length / perView);
        clampIndex();

        // on calcule la largeur d‚Äôune carte telle qu‚Äôaffich√©e (min-width)
        // et on translate par "page" (perView cartes + gaps correspondants)
        const viewportW = viewport.clientWidth;
        const cardW = (viewportW - (gap * (perView - 1))) / perView;
        const pageShift = (cardW * perView) + (gap * (perView)); // inclut le gap entre pages
        track.style.transform = `translateX(${-index * pageShift}px)`;

        prev.disabled = index === 0;
        next.disabled = index === pages - 1;

        if (dotsWrap.childElementCount !== pages) buildDots();
        setActiveDot();
      }

      function goNext(){ index++; update(); }
      function goPrev(){ index--; update(); }

      prev.addEventListener('click', goPrev);
      next.addEventListener('click', goNext);

      // Swipe mobile
      let startX = 0;
      let isDown = false;

      viewport.addEventListener('pointerdown', (e) => {
        isDown = true;
        startX = e.clientX;
        viewport.setPointerCapture(e.pointerId);
      });
      viewport.addEventListener('pointerup', (e) => {
        if (!isDown) return;
        isDown = false;
        const dx = e.clientX - startX;
        if (Math.abs(dx) < 40) return;
        if (dx < 0 && index < pages - 1) goNext();
        if (dx > 0 && index > 0) goPrev();
      });
      viewport.addEventListener('pointercancel', () => { isDown = false; });

      window.addEventListener('resize', update);

      update();
    })();
  </script>
</section>
